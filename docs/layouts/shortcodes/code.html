<!-- Arguments -->
{{ $file := .Get "file" }}
{{ $start := .Get "start" }}
{{ $end := .Get "end" }}

<!-- Read C++ source code -->
{{ $code := $file | printf "assets/include/alglib/%s" | readFile }}
{{ $lines := split $code "\n" | first $end | after (sub $start 1) }}
{{ $code := delimit $lines "\n" }}

<!-- Convert raw code to highlight code -->
{{ $pattern := "(.*<code class=\"language-cpp\" data-lang=\"cpp\">\n*)|(\n*</code>.*)" }}
{{ $hl_code := highlight $code "cpp" "" | replaceRE $pattern "" }}
{{ $hl_lines := split $hl_code "\n" }}

<figure class="code">
  {{ $url_leaf := printf "%s#L%d-L%d" $file $start $end }}
  {{ $url := path.Join "https://github.com/natrium11321/alglib/blob/master/include/alglib/" $url_leaf }}
  {{ $id := replaceRE "/|\\.|#" "-" $url_leaf }}

  <!-- Output caption -->
  <figcaption class="code-caption">
    <a target="_blank" rel="noopener noreferrer" href={{ $url }}>
      <i class="fab fa-github"></i>
      {{ $url_leaf }}
    </a>
    <span style="position: relative;">
      <button type="button" class="copy-button" data-clipboard-target="#{{ $id }}">
        <span class="fas fa-copy"></span>Copy
      </button>
      <div class="tooltip">Copied!</div>
    </span>
  </figcaption>
  <pre class="copy-text" id="{{ $id }}">{{ $code | htmlEscape | safeHTML }}</pre>

  <!-- Output highlight code -->
  <ol class="highlight">
    {{ range $hl_line := $hl_lines }}
      <li><pre><code>{{ $hl_line | safeHTML }}</code></pre></li>
    {{ end }}
  </ol>
</figure>